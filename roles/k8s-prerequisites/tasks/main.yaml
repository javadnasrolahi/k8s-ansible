---
#https://docs.ansible.com/ansible/latest/collections/ansible/posix/selinux_module.html
# - name: Disable SELinux
#   become: true
#   selinux:
#     state: disabled

- name: Letting iptables see bridged traffic
  become: true
  copy:
    src: ./files/k8s.conf
    dest: /etc/sysctl.d/k8s.conf
    owner: root
    group: root
    mode: '0644'

- name: Reload sysctl config for iptables
  become: true
  shell: sysctl --system

- name: Disable SWAP
  become: true
  shell: swapoff -a

- name: Google Cloud public signing key
  become: true
  shell: curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg


- name: Add the Kubernetes apt repository
  become: true
  shell: echo "deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list

- name: Install kubeadm kubelet kubectl packages
  become: true
  apt: 
    name: 
    - kubeadm
    - kubelet
    - kubectl 
    state: latest
    update_cache: yes

